- name: create service directory
  file: path=/etc/service/{{ application_name }} recurse=yes state=directory owner={{ deploy_user }} group={{ deploy_user }}
  sudo: yes

- name: create service run script
  template: src=runit/run dest=/etc/service/{{ application_name }}/run mode=0755 owner={{ deploy_user }} group={{ deploy_user }}
  sudo: yes

- name: wait for runit supervision
  wait_for: path=/etc/service/{{ application_name }}/supervise/lock
  sudo: yes

- name: change service control directory owner
  file: path=/etc/service/{{ application_name }}/supervise owner={{ deploy_user }} group={{ deploy_user }}
  sudo: yes
  ignore_errors: yes
